<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Frameworks | Building DC Energy Systems</title>
    <meta name="generator" content="VuePress 1.8.1">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
    <link rel="manifest" href="/favicons/site.webmanifest">
    <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/favicons/favicon.ico">
    <meta name="description" content="Open Educational Resource (OER) by Libre Solar to explain how to develop, produce and use components for DC energy systems">
    <meta name="msapplication-TileColor" content="#2b5797">
    <meta name="msapplication-config" content="/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.8526d307.css" as="style"><link rel="preload" href="/assets/js/app.eb1db606.js" as="script"><link rel="preload" href="/assets/js/3.afa2b13a.js" as="script"><link rel="preload" href="/assets/js/9.b737edab.js" as="script"><link rel="preload" href="/assets/js/22.154d22c1.js" as="script"><link rel="preload" href="/assets/js/14.6a044d5c.js" as="script"><link rel="prefetch" href="/assets/js/1.5ce743f2.js"><link rel="prefetch" href="/assets/js/10.516dbec6.js"><link rel="prefetch" href="/assets/js/11.a0354c70.js"><link rel="prefetch" href="/assets/js/12.efcc4453.js"><link rel="prefetch" href="/assets/js/13.70250085.js"><link rel="prefetch" href="/assets/js/15.e699ddaa.js"><link rel="prefetch" href="/assets/js/16.f7a083a1.js"><link rel="prefetch" href="/assets/js/17.fd67d296.js"><link rel="prefetch" href="/assets/js/18.4badd3a5.js"><link rel="prefetch" href="/assets/js/19.b0da9baf.js"><link rel="prefetch" href="/assets/js/20.391b60cd.js"><link rel="prefetch" href="/assets/js/21.f59891cf.js"><link rel="prefetch" href="/assets/js/23.9e3b570d.js"><link rel="prefetch" href="/assets/js/24.f1c73a25.js"><link rel="prefetch" href="/assets/js/25.06efb72a.js"><link rel="prefetch" href="/assets/js/26.f6d096f5.js"><link rel="prefetch" href="/assets/js/27.4795d7cc.js"><link rel="prefetch" href="/assets/js/28.6786b827.js"><link rel="prefetch" href="/assets/js/29.ea4f0826.js"><link rel="prefetch" href="/assets/js/30.ae308fed.js"><link rel="prefetch" href="/assets/js/31.0fb19ab4.js"><link rel="prefetch" href="/assets/js/32.0d0dfe9f.js"><link rel="prefetch" href="/assets/js/33.e163f558.js"><link rel="prefetch" href="/assets/js/34.69890252.js"><link rel="prefetch" href="/assets/js/35.eedfce07.js"><link rel="prefetch" href="/assets/js/36.13c5e925.js"><link rel="prefetch" href="/assets/js/37.01fef042.js"><link rel="prefetch" href="/assets/js/38.a8431c3f.js"><link rel="prefetch" href="/assets/js/39.7b9c3687.js"><link rel="prefetch" href="/assets/js/4.45530275.js"><link rel="prefetch" href="/assets/js/40.62db5135.js"><link rel="prefetch" href="/assets/js/41.4f5c956d.js"><link rel="prefetch" href="/assets/js/42.79b35d36.js"><link rel="prefetch" href="/assets/js/43.8512aa92.js"><link rel="prefetch" href="/assets/js/44.3f3c0545.js"><link rel="prefetch" href="/assets/js/45.a87c299c.js"><link rel="prefetch" href="/assets/js/46.1002321c.js"><link rel="prefetch" href="/assets/js/47.faac797e.js"><link rel="prefetch" href="/assets/js/48.a137f4ae.js"><link rel="prefetch" href="/assets/js/5.f3ba3bcc.js"><link rel="prefetch" href="/assets/js/6.4be0dc07.js"><link rel="prefetch" href="/assets/js/7.6fd8a947.js"><link rel="prefetch" href="/assets/js/8.ffe8369e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8526d307.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Building DC Energy Systems</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/system/" class="nav-link">
  System Layout
</a></div><div class="nav-item"><a href="/development/" class="nav-link router-link-active">
  Component Development
</a></div><div class="nav-item"><a href="/production/" class="nav-link">
  Production
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/system/" class="nav-link">
  System Layout
</a></div><div class="nav-item"><a href="/development/" class="nav-link router-link-active">
  Component Development
</a></div><div class="nav-item"><a href="/production/" class="nav-link">
  Production
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Hardware</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/development/dcdc_converter.html" class="sidebar-link">DC/DC Converter</a></li><li><a href="/development/load_switch.html" class="sidebar-link">Load Switch</a></li><li><a href="/development/current_measurement.html" class="sidebar-link">Current measurement</a></li><li><a href="/development/heat_dissipation.html" class="sidebar-link">Heat dissipation</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Firmware</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/development/firmware_frameworks.html" aria-current="page" class="active sidebar-link">Frameworks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/development/firmware_frameworks.html#hardware-abstraction-and-drivers" class="sidebar-link">Hardware abstraction and drivers</a></li><li class="sidebar-sub-header"><a href="/development/firmware_frameworks.html#real-time-operating-systems" class="sidebar-link">Real-time operating systems</a></li><li class="sidebar-sub-header"><a href="/development/firmware_frameworks.html#overview" class="sidebar-link">Overview</a></li></ul></li><li><a href="/development/rtos_super_loop.html" class="sidebar-link">RTOS vs. Super Loop</a></li><li><a href="/development/flashing_debugging.html" class="sidebar-link">Flashing and debugging</a></li><li><a href="/development/digital_control.html" class="sidebar-link">Digital control</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Communication</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/development/communication.html" class="sidebar-link">Communication</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="firmware-development-frameworks"><a href="#firmware-development-frameworks" class="header-anchor">#</a> Firmware Development Frameworks</h1> <p>If you want to build your embedded application, you need a couple of tools to finish your task efficiently. One important aspect is the firmware framework, which provides you with everything you need to get started.</p> <p>In order to not re-invent the wheel, a firmware framework usually contains libraries (e.g. drivers to access the hardware) and the necessary tools to build and flash the firmware.</p> <p>A very popular framework is Arduino, which comes with an entire ecosystem of boards, firmware libraries and a simple editor.</p> <p>This chapter gives an overview of the different aspects that need to be considered when selecting a firmware development framework.</p> <h2 id="hardware-abstraction-and-drivers"><a href="#hardware-abstraction-and-drivers" class="header-anchor">#</a> Hardware abstraction and drivers</h2> <p>If the same firmware should work on different microcontrollers, it makes sense to use a hardware abstraction layer (HAL) between the application code and the lower-level code directly accessing the registers of the MCU.</p> <p>An example of such an abstraction is the <code>Serial.write()</code> in Arduino firmware, which works the same way no matter if your board is based on an AVR 8-bit microcontroller or a 32-bit ESP8266.</p> <p>There are different degrees of abstraction. Chip vendors usually provide libraries (vendor HALs) which allow to reuse the code if you switch between chip families.</p> <p>Peripheral drivers with a common API across different vendors and chips can only provide the common denominator of functions. If some specific features of one chip need to be used, the driver may have to be bypassed and the lower-level functions of the chip have to be accessed directly.</p> <h2 id="real-time-operating-systems"><a href="#real-time-operating-systems" class="header-anchor">#</a> Real-time operating systems</h2> <p>For more complex embedded projects with many different tasks that have to be handled in parallel, higher-level features like multithreading can be helpful.</p> <p>These features are provided by a real-time operating system (RTOS), which might be independent of the drivers or come as an entire package with build system and drivers (as e.g. in the case of Zephyr RTOS). Frameworks that aim to work for chips of different vendors usually provide another unified driver API layer on top of the vendor HALs.</p> <p>A typical firmware architecture with an RTOS kernel and supporting layers are shown in Figure 1.</p> <figure><center><img src="/images/development/rtos-architecture.svg" alt="Firmware architecture with RTOS kernel" height="auto" width="auto"> <figcaption><b>Figure 1.</b> Firmware architecture with RTOS kernel.</figcaption></center></figure> <p>The features of an RTOS are further explained in <a href="rtos_super_loop">a dedicated chapter</a>.</p> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>For the Libre Solar project, we used <a href="https://www.arduino.cc/" target="_blank" rel="noopener noreferrer">Arduino<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://os.mbed.com/" target="_blank" rel="noopener noreferrer">ARM Mbed OS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in the past. However, the code for the charge controller and the battery management system was recently ported to <a href="https://www.zephyrproject.org/" target="_blank" rel="noopener noreferrer">Zephyr RTOS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>The main reasons for the selection of Zephyr RTOS:</p> <ul><li>Excellent build system and customization (based on Devicetree and Kconfig from Linux kernel) that allows a clear separation between board specification and the firmware itself.</li> <li>Fast integration of new microcontroller support (e.g. the STM32G4 series, which is used in the new charge controllers).</li> <li>Great community and open governance, so it’s a truly community-driven open source project.</li> <li>Strong focus on code quality and safety (aiming towards ISO 26262 and IEC 61508 certification).</li></ul> <p>The following table gives an overview of different frameworks including the aspects that were considered important for the Libre Solar project:</p> <table><thead><tr><th>Criterion</th> <th><a href="https://www.arduino.cc/" target="_blank" rel="noopener noreferrer">Arduino<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></th> <th><a href="https://os.mbed.com/" target="_blank" rel="noopener noreferrer">ARM Mbed OS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></th> <th><a href="https://www.zephyrproject.org/" target="_blank" rel="noopener noreferrer">Zephyr RTOS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></th> <th><a href="http://riot-os.org/" target="_blank" rel="noopener noreferrer">RIOT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></th> <th><a href="https://freertos.org/" target="_blank" rel="noopener noreferrer">FreeRTOS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></th></tr></thead> <tbody><tr><td>License</td> <td>LGPL</td> <td>Apache 2</td> <td>Apache 2</td> <td>LGPL</td> <td>MIT</td></tr> <tr><td>Integrated HAL</td> <td>yes</td> <td>yes</td> <td>yes</td> <td>yes</td> <td>no</td></tr> <tr><td>Integrated RTOS</td> <td>no</td> <td>yes</td> <td>yes</td> <td>yes</td> <td>yes</td></tr> <tr><td>Core language</td> <td>C++</td> <td>C++</td> <td>C</td> <td>C</td> <td>C</td></tr> <tr><td>Supported platforms</td> <td>many</td> <td>only ARM</td> <td>many</td> <td>many</td> <td>many</td></tr> <tr><td>Custom board support</td> <td>medium</td> <td>medium [1]</td> <td>good</td> <td>good</td> <td>good</td></tr> <tr><td>Target users</td> <td>makers</td> <td>both [2]</td> <td>both</td> <td>both</td> <td>industry</td></tr> <tr><td>Ease of use [3]</td> <td>good</td> <td>good</td> <td>good</td> <td>medium</td> <td>medium</td></tr></tbody></table> <p>The table was filled out to the best of our knowledge and might be subjective in some aspects. If you disagree or find errors, suggest improvements using the edit link below.</p> <p><strong>Remarks:</strong></p> <ol><li>Custom boards can be added, but you need to patch the targets.json file of the original repository. The entire framework does not differentiate between MCU definitions and board definitions. Instead, everything is gathered in one &quot;targets&quot; folder. So you can't simply define different pin settings for an already supported MCU.</li> <li>Based on how custom boards are supported, one could argue that the main focus is makers only.</li> <li>Judged good if PlatformIO available.</li></ol> <p>There are some popular frameworks not taken into consideration for the following reasons:</p> <ul><li>ChibiOS supports only STM32 microcontrollers. In addition to that, it is developed in the <a href="https://en.wikipedia.org/wiki/The_Cathedral_and_the_Bazaar" target="_blank" rel="noopener noreferrer">cathedral style<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which is not considered ideal for a community-driven open source project.</li> <li>LibOpenCM3 is only a HAL library and does not provide RTOS features.</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/LibreSolar/learn.libre.solar/edit/master/docs/development/firmware_frameworks.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/16/2020, 9:52:51 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/development/heat_dissipation.html" class="prev">
        Heat dissipation
      </a></span> <span class="next"><a href="/development/rtos_super_loop.html">
        RTOS vs. Super Loop
      </a>
      →
    </span></p></div>  <div class="footer">
    Content provided by <a href="https://libre.solar">Libre Solar</a> under <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC-BY-SA 4.0 License</a> | <a href="https://libre.solar/about/contact/">Contact / Impressum</a></div></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.eb1db606.js" defer></script><script src="/assets/js/3.afa2b13a.js" defer></script><script src="/assets/js/9.b737edab.js" defer></script><script src="/assets/js/22.154d22c1.js" defer></script><script src="/assets/js/14.6a044d5c.js" defer></script>
  </body>
</html>
